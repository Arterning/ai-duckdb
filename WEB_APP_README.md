# AI数据分析Web应用

这是一个基于Flask的Web应用，提供了一个直观的界面来上传数据文件并使用AI进行分析。

## 功能特性

- 📊 **智能数据分析**: 使用Gemini AI分析上传的数据文件
- 💬 **聊天界面**: 类似聊天应用的用户体验
- 📁 **多格式支持**: 支持CSV、Excel、Parquet、JSON文件格式
- 🌙 **Dark科技风格**: 现代化的深色主题界面
- 📱 **响应式设计**: 适配不同屏幕尺寸
- 📋 **历史记录**: 保存和查看之前的分析会话

## 技术栈

### 后端
- **Flask**: Python Web框架
- **DuckDB**: 高性能分析数据库
- **Pandas**: 数据处理和分析
- **Gemini AI**: Google的AI模型用于生成SQL查询

### 前端
- **HTML5**: 页面结构
- **Tailwind CSS**: 样式框架
- **jQuery**: JavaScript库
- **Marked.js**: Markdown解析和渲染
- **Font Awesome**: 图标库

## 安装和运行

### 1. 安装依赖

确保你的系统已经安装了Python 3.13+和uv包管理器，然后运行：

```bash
uv sync
```

### 2. 配置API密钥

确保已经配置了Google Gemini API密钥。

### 3. 启动应用

```bash
python app.py
```

应用将在 `http://localhost:5000` 上启动。

## 使用方法

1. **上传文件**:
   - 点击上传区域或拖拽文件到指定区域
   - 支持CSV、Excel (.xlsx, .xls)、Parquet、JSON格式

2. **提出问题**:
   - 在文本框中输入你想要分析的问题
   - 例如："显示销售额最高的前10个产品"

3. **查看结果**:
   - AI会生成SQL查询并执行
   - 结果以美观的表格和图表形式展示
   - 支持markdown格式的富文本显示

4. **历史记录**:
   - 左侧面板显示所有历史对话
   - 点击任意历史记录查看详情

## 界面布局

```
┌─────────────────┬───────────────────────────────┐
│                 │                               │
│   历史记录面板   │         聊天消息区域           │
│                 │                               │
│  - 新建对话按钮  │   - 用户消息                   │
│  - 历史对话列表  │   - AI分析结果                 │
│                 │   - Markdown渲染               │
│                 │                               │
├─────────────────┼───────────────────────────────┤
│                 │         文件上传 & 输入区域     │
│                 │   - 拖拽上传区域               │
│                 │   - 问题输入框                 │
│                 │   - 提交按钮                   │
└─────────────────┴───────────────────────────────┘
```

## 文件结构

```
ai-duckdb/
├── app.py                 # Flask主应用
├── doc.py                 # AI分析核心逻辑
├── templates/
│   └── index.html         # 主页面模板
├── static/
│   └── js/
│       └── app.js         # 前端JavaScript
├── uploads/               # 临时文件上传目录
├── sample_sales_data.csv  # 示例CSV数据文件
└── sample_products.json   # 示例JSON数据文件
```

## 示例查询

### 使用CSV示例文件 (sample_sales_data.csv)：
- "显示销售额最高的前5个产品"
- "按城市统计总销售额"
- "找出购买数量超过2的订单"
- "计算每个销售代表的平均佣金率"
- "显示2024年1月的所有电子产品销售"

### 使用JSON示例文件 (sample_products.json)：
- "显示价格最高的前5个产品"
- "按品牌统计产品数量"
- "找出评分超过4.5的所有产品"
- "显示库存少于30的产品"
- "按类别统计平均价格"

## 注意事项

- 文件大小限制：16MB
- 支持的文件格式：CSV, Excel (.xlsx, .xls), Parquet, JSON
- 需要有效的Gemini API密钥
- 生成的SQL查询仅支持SELECT操作，确保数据安全
- JSON文件支持多种格式：对象数组、嵌套JSON等

## 故障排除

1. **文件上传失败**: 检查文件格式和大小限制
2. **AI分析失败**: 确认Gemini API密钥配置正确
3. **界面显示异常**: 检查浏览器是否支持现代JavaScript特性
4. **无法加载历史记录**: 清除浏览器缓存并重新加载页面